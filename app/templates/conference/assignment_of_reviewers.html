{% extends "common/page_base.html" %}

{% block content %}
    <p><a href="{{ url_for('main.home_page') }}">Home</a> / <a href={{ url_for('main.admin_page') }}>{%trans%}Conference Chair{%endtrans%}</a></p>
    <h1>Assignment Of Reviewers</h1>
    <p>2) There should be a page for the Conference Chair to assign some of the registered users to
        be reviewers of the conference.</p>
    <p></p>

    <div class="table-responsive">          
        <table class="table">
          <thead>
            <tr>
              <th>Firstname</th>
              <th>Lastname</th>
              <th>Email</th>              
              <th>Active</th>
              <th>Role</th>
              <th>Set as reviewer</th>              
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
                {% if user.roles %}
                    {% for role in user.roles %}
                        {% if role.id == 1 %}
                            <tr>
                                <td>{{ user.first_name }}</td>
                                <td>{{ user.last_name }}</td>
                                <td>{{ user.email }}</td>              
                                <td></td>
                                <td>Admin</td>
                                <td></td>                            
                            </tr>
                        {% else %}  
                            <tr>
                                <td>{{ user.first_name }}</td>
                                <td>{{ user.last_name }}</td>
                                <td>{{ user.email }}</td>              
                                <td>
                                    <input type="checkbox" data-cust-id="{{ user.id }}" data-cust-value="{{ user.active }}" class="activate" name="active" {% if user.active %} checked {% endif %}>                                        
                                </td>
                                <td>Reviewer</td>
                                <td>
                                    <input type="checkbox" data-cust-id="{{ user.id }}" class="set_reviewer" name="reviewer" checked>                                                                                
                                </td>                            
                            </tr>                          
                        {% endif %}                        
                    {% endfor %}                                                                   
                {% else %}
                    <tr>
                        <td>{{ user.first_name }}</td>
                        <td>{{ user.last_name }}</td>
                        <td>{{ user.email }}</td>              
                        <td>
                            <input type="checkbox" class="activate" data-cust-id="{{ user.id }}" data-cust-value="{{ user.active }}" name="active" {% if user.active %} checked {% endif %}>                                        
                            </td>
                        <td>
                            <span>Member</span>
                        </td>
                        <td>
                            <input type="checkbox" class="set_reviewer" data-cust-id="{{ user.id }}" name="role">                    
                        </td>
                    </tr>
                {% endif %}                   
            {% endfor %}            
          </tbody>
        </table>
    </div>
        
{% endblock %}

{% block script %}
    <script type=text/javascript>        
    $(function() {
        $('.activate').bind('change', function(e) {
            e.preventDefault();                        
            var id = $(e.currentTarget).data('cust-id');
            var lastValue = $(e.currentTarget).data('cust-value');
            var action = false;
            if(lastValue!='True'){
                action = true;                
            }
            
            $.getJSON($SCRIPT_ROOT + '/activate/user', {
                "id":id,"active": action
              }, function(data) {
                  $(e.currentTarget).data('cust-value',!lastValue);          
              });
              return false;
        });

        $('.set_reviewer').bind('change', function(e) {
            e.preventDefault();                        
            var id = $(e.currentTarget).data('cust-id');
            console.log('set reviewer',id);
        });
      });
    </script>

{% endblock %}
